<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Events • yohancon</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <main class="main">
        <h1>Upcoming Events</h1>
        <p class="main-desc">Details are subject to change without prior notice of the artist or event promoter. Follow their official social media accounts for the latest information.</p>
        <section class="sort">
            <p class="sort-desc">Sort by:</p>
            <button id="new">Just Announced</button>
        </section>
        <section class="filter">
            <p class="filter-desc">Filter by:</p>
            <section>
                <button class="filter clicked" id="all">All</button>
                <button class="filter" id="concert">Concerts</button>
                <button class="filter" id="mall">Mall Shows</button>
                <button class="filter" id="gig">Gigs</button>
            </section>
        </section>

    </main>
    <footer>
        That's all I know, for now.
    </footer>


    <script src="./js/venues.js"></script>
    <script src="./js/events.js"></script>
    <script>
        function createBoard(arr) {
            for (const item of arr) {
                const row = document.createElement('article');
                
                const row_head = document.createElement('div');
                row_head.className = "title";
                row_head.textContent = `${item.artist.join(" • ")}`;

                const row_venue = document.createElement('div');
                row_venue.className = "venue";
                row_venue.textContent = `${item.venue}`;

                const row_date = document.createElement('div');
                row_date.className = "date";
                row_date.textContent = `${item.date.toLocaleDateString()}`;

                row.appendChild(row_head);
                row.appendChild(row_venue);
                row.appendChild(row_date);
                board.appendChild(row);
            }
        }

        function removeBoard() {
            const boardItems = Array.from(document.querySelectorAll("article"));
        
            for (const item of boardItems) {
                board.removeChild(item);
            }
        }

        const board = document.querySelector('main');
        const btnNew = document.querySelector('#new');
        const btnList = Array.from(document.querySelectorAll('button.filter'));
        
        const finalList = events.filter(item => (item.date >= new Date()));
        finalList.sort((a, b) => a.date - b.date);


        for (const button of btnList) {
            button.addEventListener('click', (e) => {
                for (const btn of btnList) {
                    btn.classList.remove("clicked");
                }

                button.classList.toggle("clicked");
                btnNew.classList.remove("clicked");
                let list;

                switch (button.getAttribute('id')) {
                    case 'all': 
                        list = events.filter(item => (item.date >= new Date()));
                        break;
                    default:
                        if(button.classList.contains("clicked")) {
                            list = events.filter(item => ((Object.hasOwn(item, 'type')) && (item.type == button.getAttribute("id")) && item.date >= new Date()));
                        } 
                        break;
                }

                // Checks if Recently Announced is clicked, sorts based on the result
                if(btnNew.classList.contains("clicked")) {
                    list.sort((a, b) => b.announced - a.announced);
                } else {
                    list.sort((a, b) => a.date - b.date);
                }

                removeBoard();
                createBoard(list);
            })
        }

        btnNew.addEventListener('click', (e) => {
            for (const btn of btnList) {
                if(!(btn.getAttribute('id') == 'all')) {
                    btn.classList.remove("clicked");
                } else {
                    btn.classList.add("clicked");
                }
            }

            btnNew.classList.toggle("clicked");
            let list;

            if(btnNew.classList.contains("clicked")) {
                list = events.filter(item => ((item.announced <= new Date()) && (item.date >= new Date())));
                list.sort((a, b) => b.announced - a.announced);

            } else {
                list = events.filter(item => (item.date >= new Date()));
                list.sort((a, b) => a.date - b.date);
            }

            removeBoard();
            createBoard(list);
        });

        createBoard(finalList);

    </script>
</body>
</html>